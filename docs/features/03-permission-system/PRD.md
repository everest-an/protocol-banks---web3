# æƒé™ç³»ç»ŸåŠŸèƒ½ - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| åŠŸèƒ½åç§° | å›¢é˜Ÿæƒé™ç³»ç»Ÿ (Permission System) |
| ä¼˜å…ˆçº§ | P1 - é‡è¦åŠŸèƒ½ |
| ç‰ˆæœ¬ | v1.0 |
| åˆ›å»ºæ—¥æœŸ | 2025-01-30 |
| çŠ¶æ€ | å¾…å¼€å‘ |

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 ä¸šåŠ¡èƒŒæ™¯

Web3 å›¢é˜Ÿåä½œéœ€è¦æƒé™æ§åˆ¶ï¼š
- åˆ›å§‹äººç®¡ç†èµ„é‡‘ï¼Œå‘˜å·¥åªèƒ½æŸ¥çœ‹
- è´¢åŠ¡å¯ä»¥å‘èµ·æ”¯ä»˜ï¼Œéœ€è¦åˆ›å§‹äººå®¡æ‰¹
- ä¼šè®¡éœ€è¦æŸ¥çœ‹å†å²è®°å½•å¯¼å‡ºæŠ¥è¡¨

**å½“å‰ç—›ç‚¹**ï¼š
- æ‰€æœ‰æ“ä½œéƒ½éœ€è¦é’±åŒ…ç­¾å
- æ— æ³•æˆæƒä»–äººæŸ¥çœ‹æˆ–æ“ä½œ
- ç°æœ‰å¤šç­¾åŠŸèƒ½å¤ªé‡ï¼Œä¸é€‚åˆæ—¥å¸¸

### 1.2 äº§å“ç›®æ ‡

> ç®€å•çš„ Owner/Admin/Viewer ä¸‰çº§æƒé™ï¼Œæ»¡è¶³å°å›¢é˜Ÿæ—¥å¸¸éœ€æ±‚

**è®¾è®¡åŸåˆ™**ï¼š
- ç®€å• > å¤æ‚ï¼ˆä¸åš RBACï¼‰
- å®‰å…¨ > ä¾¿æ·ï¼ˆå…³é”®æ“ä½œéœ€ç­¾åç¡®è®¤ï¼‰
- éæ‰˜ç®¡ï¼ˆåªæˆæƒè¯»å–ï¼Œä¸æˆæƒè½¬è´¦ï¼‰

---

## 2. è§’è‰²å®šä¹‰

### 2.1 ä¸‰çº§è§’è‰²

| è§’è‰² | æƒé™ | å…¸å‹ç”¨æˆ· |
|------|------|---------|
| **Owner** | å…¨éƒ¨æƒé™ï¼Œå¯ç®¡ç†å›¢é˜Ÿæˆå‘˜ | åˆ›å§‹äººã€è´¢åŠ¡æ€»ç›‘ |
| **Admin** | åˆ›å»ºæ”¯ä»˜ã€ç®¡ç†è®¢é˜…ã€æŸ¥çœ‹å…¨éƒ¨ | è´¢åŠ¡ã€è¿è¥ |
| **Viewer** | ä»…æŸ¥çœ‹è®°å½•å’ŒæŠ¥è¡¨ | ä¼šè®¡ã€æŠ•èµ„äºº |

### 2.2 æƒé™çŸ©é˜µ

| æ“ä½œ | Owner | Admin | Viewer |
|------|-------|-------|--------|
| æŸ¥çœ‹ä½™é¢ | âœ… | âœ… | âœ… |
| æŸ¥çœ‹äº¤æ˜“å†å² | âœ… | âœ… | âœ… |
| å¯¼å‡ºæŠ¥è¡¨ | âœ… | âœ… | âœ… |
| åˆ›å»ºå•ç¬”æ”¯ä»˜ | âœ… | âœ… | âŒ |
| åˆ›å»ºæ‰¹é‡æ”¯ä»˜ | âœ… | âœ… | âŒ |
| æ‰§è¡Œæ”¯ä»˜ï¼ˆç­¾åï¼‰ | âœ… | âŒ* | âŒ |
| ç®¡ç†åˆ†è´¦æ¨¡æ¿ | âœ… | âœ… | âŒ |
| ç®¡ç†å®šæ—¶å‘è–ª | âœ… | âœ… | âŒ |
| ç®¡ç†å›¢é˜Ÿæˆå‘˜ | âœ… | âŒ | âŒ |
| ä¿®æ”¹è®¾ç½® | âœ… | âŒ | âŒ |

*Admin åˆ›å»ºçš„æ”¯ä»˜éœ€è¦ Owner ç­¾åæ‰§è¡Œ

---

## 3. åŠŸèƒ½è®¾è®¡

### 3.1 å›¢é˜Ÿç®¡ç†

**é‚€è¯·æˆå‘˜**ï¼š
1. Owner ç”Ÿæˆé‚€è¯·é“¾æ¥ï¼ˆå«ç­¾åï¼‰
2. è¢«é‚€è¯·äººè®¿é—®é“¾æ¥ï¼Œè¿æ¥é’±åŒ…
3. ç­¾åç¡®è®¤åŠ å…¥å›¢é˜Ÿ
4. Owner è®¾ç½®è§’è‰²

**æˆå‘˜åˆ—è¡¨**ï¼š
- æ˜¾ç¤ºé’±åŒ…åœ°å€ã€è§’è‰²ã€åŠ å…¥æ—¶é—´
- æ”¯æŒä¿®æ”¹è§’è‰²ã€ç§»é™¤æˆå‘˜
- Owner ä¸å¯è¢«ç§»é™¤

### 3.2 è®¿é—®æ§åˆ¶

**å®ç°æ–¹å¼**ï¼š
- å‰ç«¯ï¼šæ ¹æ®è§’è‰²æ˜¾ç¤º/éšè—åŠŸèƒ½
- åç«¯ï¼šAPI éªŒè¯è§’è‰²æƒé™
- æ•°æ®åº“ï¼šRLS ç­–ç•¥æ§åˆ¶æ•°æ®è®¿é—®

### 3.3 å®¡æ‰¹æµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰

å½“ Admin åˆ›å»ºæ”¯ä»˜æ—¶ï¼š
1. åˆ›å»ºå¾…å®¡æ‰¹ä»»åŠ¡
2. é€šçŸ¥ Owner
3. Owner ç­¾åæ‰§è¡Œæˆ–æ‹’ç»

---

## 4. ç•Œé¢è®¾è®¡

### 4.1 å›¢é˜Ÿè®¾ç½®é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Settings > Team                                     [é‚€è¯·æˆå‘˜]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  å›¢é˜Ÿæˆå‘˜ (3)                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ 0x123...abc                               [Owner] ä½     â”‚ â”‚
â”‚  â”‚    åˆ›å§‹äºº Â· 2024-06-01 åŠ å…¥                                â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ‘¤ 0x456...def                               [Admin] â–¼    â”‚ â”‚
â”‚  â”‚    è´¢åŠ¡ Â· 2024-08-15 åŠ å…¥                    [ç§»é™¤]        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ‘¤ 0x789...ghi                               [Viewer] â–¼   â”‚ â”‚
â”‚  â”‚    ä¼šè®¡ Â· 2024-10-01 åŠ å…¥                    [ç§»é™¤]        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  å¾…å¤„ç†é‚€è¯· (1)                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ é‚€è¯·é“¾æ¥ #A1B2C3   æœ‰æ•ˆæœŸè‡³ 2025-02-01       [å¤åˆ¶] [æ’¤é”€] â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ•°æ®è®¾è®¡

### 5.1 æ•°æ®åº“è¡¨

```sql
-- å›¢é˜Ÿè¡¨
CREATE TABLE teams (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  owner_address VARCHAR(42) NOT NULL UNIQUE,
  name VARCHAR(100),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å›¢é˜Ÿæˆå‘˜è¡¨
CREATE TABLE team_members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID NOT NULL REFERENCES teams(id),
  member_address VARCHAR(42) NOT NULL,
  role VARCHAR(20) NOT NULL DEFAULT 'viewer',
  nickname VARCHAR(50),
  invited_by VARCHAR(42),
  joined_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  CONSTRAINT valid_role CHECK (role IN ('owner', 'admin', 'viewer')),
  CONSTRAINT unique_member UNIQUE (team_id, member_address)
);

-- é‚€è¯·è¡¨
CREATE TABLE team_invites (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID NOT NULL REFERENCES teams(id),
  invite_code VARCHAR(20) NOT NULL UNIQUE,
  role VARCHAR(20) NOT NULL DEFAULT 'viewer',
  created_by VARCHAR(42) NOT NULL,
  expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
  used_by VARCHAR(42),
  used_at TIMESTAMP WITH TIME ZONE,
  status VARCHAR(20) NOT NULL DEFAULT 'pending',

  CONSTRAINT valid_invite_status CHECK (status IN ('pending', 'used', 'expired', 'cancelled'))
);
```

### 5.2 RLS ç­–ç•¥

```sql
-- å›¢é˜Ÿæˆå‘˜åªèƒ½çœ‹åˆ°è‡ªå·±å›¢é˜Ÿçš„æ•°æ®
CREATE POLICY "Team members can view team data"
  ON payments FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM team_members tm
      JOIN teams t ON tm.team_id = t.id
      WHERE tm.member_address = current_setting('app.user_address', true)
        AND t.owner_address = payments.created_by
    )
  );
```

---

## 6. API è®¾è®¡

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° | æƒé™ |
|------|------|------|------|
| `/api/team` | GET | è·å–å›¢é˜Ÿä¿¡æ¯ | All |
| `/api/team/members` | GET | è·å–æˆå‘˜åˆ—è¡¨ | All |
| `/api/team/members` | POST | æ·»åŠ æˆå‘˜ï¼ˆé‚€è¯·ï¼‰ | Owner |
| `/api/team/members/[address]` | PUT | ä¿®æ”¹æˆå‘˜è§’è‰² | Owner |
| `/api/team/members/[address]` | DELETE | ç§»é™¤æˆå‘˜ | Owner |
| `/api/team/invites` | GET | è·å–é‚€è¯·åˆ—è¡¨ | Owner |
| `/api/team/invites` | POST | åˆ›å»ºé‚€è¯· | Owner |
| `/api/team/invites/[code]` | DELETE | æ’¤é”€é‚€è¯· | Owner |
| `/api/team/join/[code]` | POST | æ¥å—é‚€è¯· | Any |

---

## 7. å®‰å…¨è€ƒè™‘

### 7.1 é‚€è¯·å®‰å…¨

- é‚€è¯·é“¾æ¥æœ‰æ•ˆæœŸ 7 å¤©
- æ¯ä¸ªé“¾æ¥åªèƒ½ä½¿ç”¨ä¸€æ¬¡
- é‚€è¯·éœ€è¦ Owner ç­¾å

### 7.2 æ“ä½œå®‰å…¨

- å…³é”®æ“ä½œéœ€è¦ç­¾åéªŒè¯
- Admin åˆ›å»ºçš„æ”¯ä»˜ä¸èƒ½ç›´æ¥æ‰§è¡Œ
- æ—¥å¿—è®°å½•æ‰€æœ‰æƒé™å˜æ›´

---

## 8. å®ç°è®¡åˆ’

### MVP èŒƒå›´

- [x] åŸºç¡€è§’è‰²å®šä¹‰ (Owner/Admin/Viewer)
- [x] å›¢é˜Ÿæˆå‘˜ç®¡ç†
- [x] é‚€è¯·é“¾æ¥
- [x] å‰ç«¯æƒé™æ§åˆ¶
- [ ] åç«¯ API æƒé™éªŒè¯
- [ ] Admin æ”¯ä»˜å®¡æ‰¹æµç¨‹ï¼ˆå¯æ”¾ v1.1ï¼‰

---

**æœ€åæ›´æ–°**: 2025-01-30
