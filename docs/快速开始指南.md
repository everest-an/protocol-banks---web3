# å¤šç½‘ç»œæ”¯æŒ?- å¿«é€Ÿå¼€å§‹æŒ‡å?

## ğŸ¯ 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰?

### å‰ç½®æ¡ä»¶æ£€æŸ?

```bash
# 1. æ£€æŸ?Node.js ç‰ˆæœ¬ï¼ˆéœ€è¦?18+ï¼?
node --version

# 2. æ£€æŸ?pnpm æ˜¯å¦å®‰è£…
pnpm --version

# 3. æ£€æŸ?PostgreSQL æ˜¯å¦è¿è¡Œ
# Windows: æ£€æŸ¥ä»»åŠ¡ç®¡ç†å™¨ä¸­çš„ postgres.exe
# æˆ–è¿è¡Œï¼š
netstat -an | findstr :51214
```

---

## ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨æ•°æ®åº?

### é€‰é¡¹ Aï¼šå¦‚æœä½¿ç”?Docker

```bash
# å¯åŠ¨ PostgreSQL å®¹å™¨
docker start <your-postgres-container-name>

# éªŒè¯æ•°æ®åº“è¿è¡?
docker ps | findstr postgres
```

### é€‰é¡¹ Bï¼šå¦‚æœä½¿ç”¨æœ¬åœ?PostgreSQL

```bash
# Windows
pg_ctl start -D "C:\Program Files\PostgreSQL\15\data"

# éªŒè¯
psql -h localhost -p 51214 -U postgres -c "SELECT version();"
```

---

## ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§?

### æ–¹æ³• 1ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd "e:\Protocol Bank\Development\å†å²ç‰ˆæœ¬\protocol-banks---web3-main"

# Windows
scripts\run-migration.bat

# è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
# 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
# 2. æ¨é€?Prisma schema
# 3. ç”Ÿæˆ Prisma client
# 4. åº”ç”¨ SQL è¿ç§»ï¼ˆå¦‚æœå®‰è£…äº† psqlï¼?
```

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨åˆ†æ­¥æ‰§è¡?

```bash
cd "e:\Protocol Bank\Development\å†å²ç‰ˆæœ¬\protocol-banks---web3-main"

# 1. æ¨é€?schema åˆ°æ•°æ®åº“
pnpm prisma db push

# 2. éªŒè¯è¡¨æ˜¯å¦åˆ›å»?
pnpm prisma studio
# æ‰“å¼€æµè§ˆå™¨ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ vendor_addresses è¡?

# 3. ï¼ˆå¯é€‰ï¼‰åº”ç”¨é«˜çº§ SQL åŠŸèƒ½
# å¦‚æœå®‰è£…äº?psqlï¼?
psql -h localhost -p 51214 -U postgres -d template1 -f scripts\009_multi_network_support.sql
```

---

## ç¬¬ä¸‰æ­¥ï¼šéªŒè¯è¿ç§»æˆåŠŸ

### ä½¿ç”¨ Prisma Studio

```bash
pnpm prisma studio
```

åœ¨æµè§ˆå™¨ä¸­éªŒè¯ï¼š
- âœ?`vendor_addresses` è¡¨å·²åˆ›å»º
- âœ?`payments` è¡¨æœ‰æ–°å­—æ®µï¼š`network_type`, `chain_id`, `energy_used` ç­?
- âœ?`batch_payments` è¡¨æœ‰æ–°å­—æ®µï¼š`chain`, `network_type`

### ä½¿ç”¨ SQL æŸ¥è¯¢

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT table_name
FROM information_schema.tables
WHERE table_name = 'vendor_addresses';

-- æ£€æŸ¥æ–°å­—æ®µ
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name = 'payments'
AND column_name IN ('network_type', 'chain_id', 'energy_used');

-- æ£€æŸ¥è§†å›¾ï¼ˆå¦‚æœè¿è¡Œäº?SQL è¿ç§»ï¼?
SELECT table_name
FROM information_schema.views
WHERE table_name LIKE 'vendor_%' OR table_name LIKE '%network%';
```

---

## ç¬¬å››æ­¥ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨
pnpm dev

# æœåŠ¡å™¨å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š
# â–?Next.js 15.x.x
# - Local:        http://localhost:3000
# - Ready in XXXms
```

---

## ç¬¬äº”æ­¥ï¼šæµ‹è¯• APIï¼?ä¸ªåŸºç¡€æµ‹è¯•ï¼?

### æµ‹è¯• 1ï¼šåˆ›å»ºå¤šç½‘ç»œä¾›åº”å•?

```bash
curl -X POST http://localhost:3000/api/vendors/multi-network ^
  -H "Content-Type: application/json" ^
  -H "x-wallet-address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2" ^
  -d "{\"name\":\"æµ‹è¯•ä¾›åº”å•†\",\"addresses\":[{\"network\":\"ethereum\",\"address\":\"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2\",\"isPrimary\":true},{\"network\":\"tron\",\"address\":\"TQn9Y2khEsLJW1ChVWFMSMeRDow5KcbLSE\",\"isPrimary\":true}]}"
```

**é¢„æœŸç»“æœï¼?*
```json
{
  "vendor": {
    "id": "...",
    "name": "æµ‹è¯•ä¾›åº”å•?,
    "addresses": [
      { "network": "ethereum", "address": "0x742d...", "isPrimary": true },
      { "network": "tron", "address": "TQn9...", "isPrimary": true }
    ]
  },
  "message": "Vendor created successfully"
}
```

### æµ‹è¯• 2ï¼šåˆ—å‡ºæ‰€æœ‰ä¾›åº”å•†

```bash
curl http://localhost:3000/api/vendors/multi-network ^
  -H "x-wallet-address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2"
```

### æµ‹è¯• 3ï¼šåˆ›å»?TRON æ”¯ä»˜ï¼ˆè‡ªåŠ¨æ£€æµ‹ç½‘ç»œï¼‰

```bash
curl -X POST http://localhost:3000/api/payments ^
  -H "Content-Type: application/json" ^
  -H "x-wallet-address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2" ^
  -d "{\"from_address\":\"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2\",\"to_address\":\"TQn9Y2khEsLJW1ChVWFMSMeRDow5KcbLSE\",\"amount\":\"100\",\"token\":\"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t\",\"token_symbol\":\"USDT\",\"type\":\"sent\"}"
```

**é¢„æœŸç»“æœï¼?*
```json
{
  "payment": {
    "network_type": "TRON",  // âœ?è‡ªåŠ¨æ£€æµ?
    "chain": "tron",         // âœ?è‡ªåŠ¨è®¾ç½®
    "chain_id": null
  }
}
```

### æµ‹è¯• 4ï¼šæŒ‰ç½‘ç»œç­›é€‰æ”¯ä»?

```bash
# è·å–æ‰€æœ?TRON æ”¯ä»˜
curl "http://localhost:3000/api/payments?network=tron&limit=10" ^
  -H "x-wallet-address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2"

# è·å–æ‰€æœ?EVM æ”¯ä»˜
curl "http://localhost:3000/api/payments?network_type=EVM&limit=10" ^
  -H "x-wallet-address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2"
```

### æµ‹è¯• 5ï¼šè·å–æ”¯ä»˜ç»Ÿè®?

```bash
# æ€»ä½“ç»Ÿè®¡
curl http://localhost:3000/api/payments/stats ^
  -H "x-wallet-address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2"

# TRON ç»Ÿè®¡
curl "http://localhost:3000/api/payments/stats?network_type=TRON" ^
  -H "x-wallet-address: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2"
```

---

## ç¬¬å…­æ­¥ï¼šåœ?UI ä¸­ä½¿ç”¨ç»„ä»?

### åœ¨ä¾›åº”å•†ç¼–è¾‘é¡µé¢ä¸­ä½¿ç”¨åœ°å€ç®¡ç†å™?

```tsx
// app/(products)/vendors/[id]/edit/page.tsx
import { VendorAddressManager } from "@/components/vendors/vendor-address-manager"

export default function VendorEditPage({ params }: { params: { id: string } }) {
  const { data: vendor } = useVendor(params.id)
  const { address: userAddress } = useWallet()

  return (
    <div>
      <h1>ç¼–è¾‘ä¾›åº”å•?/h1>

      {/* å¤šç½‘ç»œåœ°å€ç®¡ç† */}
      <VendorAddressManager
        vendorId={params.id}
        addresses={vendor?.addresses || []}
        onUpdate={() => refetch()}
        userAddress={userAddress}
      />
    </div>
  )
}
```

### åœ¨äº¤æ˜“å†å²é¡µé¢ä¸­ä½¿ç”¨äº¤æ˜“åˆ—è¡¨

```tsx
// app/(products)/history/page.tsx
import { TransactionList } from "@/components/transactions/transaction-list"

export default function HistoryPage() {
  const { address } = useWallet()

  return (
    <div>
      <h1>äº¤æ˜“å†å²</h1>

      {/* å¸¦ç½‘ç»œç­›é€‰çš„äº¤æ˜“åˆ—è¡¨ */}
      <TransactionList
        userAddress={address}
        initialFilters={{
          network_type: "all"  // æˆ?"EVM" | "TRON"
        }}
      />
    </div>
  )
}
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### â?é—®é¢˜ï¼šæ— æ³•è¿æ¥æ•°æ®åº“

**é”™è¯¯ä¿¡æ¯ï¼?*
```
Error: P1001
Can't reach database server at localhost:51214
```

**è§£å†³æ–¹æ¡ˆï¼?*
1. æ£€æŸ?PostgreSQL æ˜¯å¦è¿è¡Œï¼?
   ```bash
   # Windows
   tasklist | findstr postgres

   # æˆ–æ£€æŸ¥ç«¯å?
   netstat -an | findstr :51214
   ```

2. æ£€æŸ?`.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL`

3. å°è¯•æ‰‹åŠ¨è¿æ¥ï¼?
   ```bash
   psql -h localhost -p 51214 -U postgres
   ```

### â?é—®é¢˜ï¼šPrisma client ç‰ˆæœ¬ä¸åŒ¹é…?

**é”™è¯¯ä¿¡æ¯ï¼?*
```
PrismaClientInitializationError: Prisma Client could not locate...
```

**è§£å†³æ–¹æ¡ˆï¼?*
```bash
# é‡æ–°ç”Ÿæˆ Prisma client
pnpm prisma generate

# æ¸…é™¤ç¼“å­˜
rm -rf node_modules/.prisma
pnpm install
```

### â?é—®é¢˜ï¼šAPI è¿”å› 401 Unauthorized

**åŸå› ï¼?* ç¼ºå°‘è®¤è¯å¤?

**è§£å†³æ–¹æ¡ˆï¼?*
ç¡®ä¿æ‰€æœ?API è¯·æ±‚éƒ½åŒ…å?`x-wallet-address` headerï¼?
```bash
curl ... -H "x-wallet-address: YOUR_WALLET_ADDRESS"
```

### â?é—®é¢˜ï¼šåœ°å€éªŒè¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼?*
```json
{ "error": "Invalid address: ..." }
```

**è§£å†³æ–¹æ¡ˆï¼?*
1. æ£€æŸ¥åœ°å€æ ¼å¼ï¼?
   - EVM: `0x` å¼€å¤´ï¼Œ42 å­—ç¬¦
   - TRON: `T` å¼€å¤´ï¼Œ34 å­—ç¬¦

2. ç¡®ä¿åœ°å€æ˜¯æœ‰æ•ˆçš„æ ¡éªŒå’Œæ ¼å¼ï¼ˆEVMï¼?

---

## ä¸‹ä¸€æ­?

å®ŒæˆåŸºç¡€æµ‹è¯•åï¼Œæ‚¨å¯ä»¥ï¼š

1. **é›†æˆåˆ°ç°æœ‰é¡µé?*
   - åœ¨ä¾›åº”å•†ç®¡ç†é¡µé¢æ·»åŠ å¤šç½‘ç»œæ”¯æŒ?
   - åœ¨äº¤æ˜“å†å²é¡µé¢æ·»åŠ ç½‘ç»œç­›é€?

2. **è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶**
   ```bash
   pnpm test
   ```

3. **æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**
   - [å®Œæ•´ API å‚è€ƒ](./MULTI_NETWORK_IMPLEMENTATION.md)
   - [æµ‹è¯•æŒ‡å—](./TESTING_GUIDE.md)

4. **ç›‘æ§å’Œä¼˜åŒ?*
   - ä½¿ç”¨ Prisma Studio æŸ¥çœ‹æ•°æ®
   - æ£€æŸ?API å“åº”æ—¶é—´
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯?

---

## ğŸ‰ å®Œæˆï¼?

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸè®¾ç½®äº†å¤šç½‘ç»œæ”¯æŒã€‚ç°åœ¨å¯ä»¥ï¼š
- âœ?ç®¡ç†å¤šç½‘ç»œä¾›åº”å•†åœ°å€
- âœ?åˆ›å»ºå’Œç­›é€‰å¤šç½‘ç»œæ”¯ä»˜
- âœ?æŸ¥çœ‹æŒ‰ç½‘ç»œåˆ†ç±»çš„ç»Ÿè®¡æ•°æ®
- âœ?ä½¿ç”¨ UI ç»„ä»¶è¿›è¡Œåœ°å€ç®¡ç†

**æœ‰é—®é¢˜ï¼Ÿ** æŸ¥çœ‹ [TESTING_GUIDE.md](./TESTING_GUIDE.md) è·å–æ›´å¤šå¸®åŠ©ã€?
